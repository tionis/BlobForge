{{template "base" .}}

{{define "content"}}
<div class="page-header">
    <h1 class="page-title">Administration</h1>
</div>

<div class="grid-2">
    <!-- API Tokens -->
    <div class="card">
        <div class="card-header">
            <h2>API Tokens</h2>
            <button class="btn btn-primary btn-sm" onclick="BlobForge.showModal('create-token-modal')">
                + Create Token
            </button>
        </div>
        <div class="card-body">
            {{if .Tokens}}
            <div class="list-group">
                {{range .Tokens}}
                <div class="list-item">
                    <div class="list-item-content">
                        <span class="list-item-title">{{.Name}}</span>
                        {{if .IsAdmin}}<span class="status-badge status-failed">Admin</span>{{end}}
                        <p class="text-muted text-sm">
                            Created: {{formatTime (addr .CreatedAt)}}
                            {{if .LastUsedAt}}â€¢ Last used: {{timeAgo .LastUsedAt}}{{end}}
                        </p>
                    </div>
                    <button 
                        class="btn btn-danger btn-sm"
                        hx-delete="/api/tokens/{{.ID}}"
                        hx-confirm="Are you sure you want to delete this token?"
                        hx-target="closest .list-item"
                        hx-swap="outerHTML">
                        Delete
                    </button>
                </div>
                {{end}}
            </div>
            {{else}}
            <p class="text-muted text-center">No API tokens created yet.</p>
            {{end}}
        </div>
    </div>

    <!-- Users -->
    <div class="card">
        <div class="card-header">
            <h2>Users</h2>
        </div>
        <div class="card-body">
            {{if .Users}}
            <div class="list-group">
                {{range .Users}}
                <div class="list-item">
                    <div class="list-item-content">
                        <span class="list-item-title">{{.Name}}</span>
                        {{if .IsAdmin}}<span class="status-badge status-failed">Admin</span>{{end}}
                        <p class="text-muted text-sm">{{.Email}}</p>
                    </div>
                    <span class="text-muted text-sm">{{.Provider}}</span>
                </div>
                {{end}}
            </div>
            {{else}}
            <p class="text-muted text-center">No users yet. Users are created when they log in via OIDC.</p>
            {{end}}
        </div>
    </div>
</div>

<!-- System Info -->
<div class="card mt-6">
    <div class="card-header">
        <h2>System Configuration</h2>
    </div>
    <div class="card-body">
        <div class="config-grid">
            <div class="config-item">
                <span class="config-label">Authentication:</span>
                <span class="{{if .AuthEnabled}}text-success{{else}}text-warning{{end}}">
                    {{if .AuthEnabled}}OIDC Enabled{{else}}Disabled{{end}}
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Create Token Modal -->
<div id="create-token-modal" class="modal-backdrop">
    <div class="modal">
        <div class="modal-header">
            <h3>Create API Token</h3>
            <button class="modal-close" onclick="BlobForge.hideModal('create-token-modal')">&times;</button>
        </div>
        <form hx-post="/api/tokens" hx-target="#token-result">
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Token Name</label>
                    <input type="text" name="name" required class="form-input" placeholder="my-worker-token">
                </div>
                <div class="form-group">
                    <label class="form-checkbox">
                        <input type="checkbox" name="is_admin" value="true">
                        <span>Admin privileges</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">Expires in (days, 0 = never)</label>
                    <input type="number" name="expires_in" value="0" min="0" class="form-input">
                </div>
                <div id="token-result"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="BlobForge.hideModal('create-token-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Create</button>
            </div>
        </form>
    </div>
</div>
{{end}}
