{{template "base" .}}

{{define "content"}}
<div class="page-header">
    <h1 class="page-title">Workers</h1>
    <div class="page-actions">
        <button class="btn btn-primary" onclick="BlobForge.showModal('add-worker-modal')">
            + Register Worker
        </button>
    </div>
</div>

<div class="card">
    <div class="card-body" id="workers-table" 
         hx-get="/partials/workers" 
         hx-trigger="every 5s, sse:worker_online, sse:worker_offline" 
         hx-swap="innerHTML">
        {{template "workers_table.html" .}}
    </div>
</div>

<!-- Add Worker Modal -->
<div id="add-worker-modal" class="modal-backdrop">
    <div class="modal">
        <div class="modal-header">
            <h3>Register New Worker</h3>
            <button class="modal-close" onclick="BlobForge.hideModal('add-worker-modal')">&times;</button>
        </div>
        <form hx-post="/api/workers" hx-target="#add-worker-result" hx-swap="innerHTML">
            <div class="modal-body">
                <p class="text-secondary mb-4">
                    Workers self-register when they start. Use this form to pre-register a worker 
                    or generate registration commands.
                </p>
                <div class="form-group">
                    <label class="form-label">Worker Name</label>
                    <input type="text" name="name" required class="form-input" placeholder="worker-01">
                </div>
                <div class="form-group">
                    <label class="form-label">Worker Type</label>
                    <select name="worker_type" class="form-select">
                        <option value="pdf-convert">PDF Convert</option>
                        <option value="ocr">OCR</option>
                        <option value="general">General</option>
                    </select>
                </div>
                <div id="add-worker-result"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="BlobForge.hideModal('add-worker-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Register</button>
            </div>
        </form>
    </div>
</div>

<!-- Worker Details Modal (for drain/remove actions) -->
<div id="worker-details-modal" class="modal-backdrop">
    <div class="modal">
        <div class="modal-header">
            <h3>Worker Details</h3>
            <button class="modal-close" onclick="BlobForge.hideModal('worker-details-modal')">&times;</button>
        </div>
        <div class="modal-body" id="worker-details-content">
            <!-- Loaded via HTMX -->
        </div>
    </div>
</div>
{{end}}
