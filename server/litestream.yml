# Litestream configuration for BlobForge
#
# This file configures continuous SQLite replication to S3.
# Uses the same S3 credentials as BlobForge (stores backups in litestream/ prefix).
#
# NOTE: This config is a template. The actual config is generated by run.sh
# to support optional Age encryption and the exec pattern.
#
# Environment variables (same as BlobForge):
#   BLOBFORGE_DB_PATH - Path to SQLite database
#   BLOBFORGE_S3_BUCKET - S3 bucket name
#   BLOBFORGE_S3_ENDPOINT - S3 endpoint (for R2, MinIO)
#   BLOBFORGE_S3_ACCESS_KEY - S3 access key
#   BLOBFORGE_S3_SECRET_KEY - S3 secret key
#   BLOBFORGE_S3_REGION - S3 region
#
# Optional encryption:
#   BLOBFORGE_LITESTREAM_AGE_SECRET_KEY - Age secret key for encryption
#   BLOBFORGE_LITESTREAM_AGE_PUBLIC_KEY - Age public key for encryption
#
# Control:
#   BLOBFORGE_LITESTREAM_DISABLED - Set to "true" to disable Litestream

# Exec directive - Litestream supervises the BlobForge server process
exec: /app/blobforge

dbs:
  - path: ${BLOBFORGE_DB_PATH:-/app/data/blobforge.db}
    replicas:
      - type: s3
        bucket: ${BLOBFORGE_S3_BUCKET}
        path: litestream
        endpoint: ${BLOBFORGE_S3_ENDPOINT}
        region: ${BLOBFORGE_S3_REGION:-auto}
        access-key-id: ${BLOBFORGE_S3_ACCESS_KEY}
        secret-access-key: ${BLOBFORGE_S3_SECRET_KEY}
        # Sync every 10 seconds (default is 1 minute)
        sync-interval: 10s
        # Keep snapshots for 7 days
        retention: 168h
        # Snapshot every 6 hours
        snapshot-interval: 6h
